# Example WGX profile used as CI fallback.
# Copy to .wgx/profile.yml and adjust values as needed.
version: 1
repo:
  name: auto
  description: "WGX profile example for unified tasks and env priorities"

env_priority:
  - devcontainer
  - devbox
  - mise_direnv
  - termux

tooling:
  python:
    uv: true
    precommit: true
  rust:
    cargo: auto
    clippy_strict: true
    fmt_check: true
    deny: optional

tasks:
  up:
    desc: "Dev-Umgebung hochfahren (Container/venv/tooling bootstrap)"
    sh:
      - |
        if command -v devcontainer >/dev/null 2>&1 || [ -f .devcontainer/devcontainer.json ]; then
          echo "[wgx.up] devcontainer context detected"
        fi
        if command -v uv >/dev/null 2>&1; then
          uv --version || true
          [ -f pyproject.toml ] && uv sync --frozen || true
        fi
        [ -f .pre-commit-config.yaml ] && command -v pre-commit >/dev/null 2>&1 && pre-commit install || true
  lint:
    desc: "Schnelle statische Checks (Rust/Python/Markdown/YAML)"
    sh:
      - |
        if [ -f Cargo.toml ]; then
          cargo fmt --all -- --check
          cargo clippy --all-targets --all-features -- -D warnings
        fi
        if [ -f pyproject.toml ]; then
          if command -v uv >/dev/null 2>&1; then
            uv run ruff check . || true
            uv run ruff format --check . || true
          fi
        fi
        command -v markdownlint >/dev/null 2>&1 && markdownlint "**/*.md" || true
        command -v yamllint    >/dev/null 2>&1 && yamllint . || true
  test:
    desc: "Testsuite"
    sh:
      - |
        if [ -f Cargo.toml ]; then
          if ! cargo test --all --all-features; then
            echo "[wgx.test] WARNING: cargo test failed but is being ignored"
          fi
        fi
        if [ -f pyproject.toml ] && command -v uv >/dev/null 2>&1; then
          if ! uv run pytest -q; then
            echo "[wgx.test] WARNING: pytest failed but is being ignored"
          fi
        fi
  build:
    desc: "Build-Artefakte erstellen"
    sh:
      - |
        [ -f Cargo.toml ] && cargo build --release || true
        if [ -f pyproject.toml ] && command -v uv >/dev/null 2>&1; then
          uv build || true
        fi
  smoke:
    desc: "Schnelle Smoke-Checks (l√§uft <60s)"
    sh:
      - |
        echo "[wgx.smoke] repo=$(basename \"$(git rev-parse --show-toplevel)\")"
        [ -f Cargo.toml ] && cargo metadata --no-deps > /dev/null || true
        [ -f pyproject.toml ] && grep -q '^\[project\]' pyproject.toml || true

meta:
  owner: "alexdermohr"
  conventions:
    gewebedir: ".gewebe"
    version_endpoint: "/version"
    tasks_standardized: true