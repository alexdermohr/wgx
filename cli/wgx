#!/usr/bin/env bash
set -euo pipefail

# WGX_DIR auf Root des Repos setzen (egal woher das Skript aufgerufen wird)
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WGX_DIR="$(dirname "$DIR")"
export WGX_DIR

# Version anzeigen, bevor weitere Komponenten geladen werden
__WGX_VERSION__="2.0.3"
export WGX_VERSION="$__WGX_VERSION__"
case "${1:-}" in
  --version|-V)
    echo "wgx ${__WGX_VERSION__}"
    exit 0
    ;;
esac

# libs laden (alphabetisch hält Ordnung)
if [ -d "$WGX_DIR/lib" ]; then
  for f in "$WGX_DIR/lib/"*.bash; do
    if [ -r "$f" ]; then
      if [[ ${WGX_DEBUG:-0} != 0 ]]; then
        echo "Loading library: $f" >&2
      fi
      if ! source "$f"; then
        echo "Error: Failed to source library file: $f" >&2
        exit 1
      fi
    fi
  done
fi

# Default-Branch / Basis für Reload
: "${WGX_BASE:=main}"

# Haupteinstieg
wgx_main "$@"
